<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.luan.jerry.category.dao.CategoryDAO">

    <cache/>

    <select id="getCategory" resultMap="categoryResultMap">
        SELECT
        p.*, count(c.id) as child_count
        FROM
        jerry_category.categories p
        LEFT JOIN
        categories c ON c.parent_id = p.id
        WHERE
        p.id = #{categoryId}
        GROUP BY
        p.id
    </select>

    <select id="getCategoryList" resultMap="categoryResultMap">
        SELECT
        p.*, count(c.id) as child_count
        FROM
        jerry_category.categories p
        LEFT JOIN
        categories c ON c.parent_id = p.id
        GROUP BY
        p.id
    </select>

    <resultMap id="categoryResultMap" type="Category">
        <id property="categoryId" column="category_id"/>
        <result property="parentId" column="parent_id"/>
        <result property="sortOrder" column="sort_order"/>
        <result property="childCount" column="child_count"/>
    </resultMap>

</mapper>