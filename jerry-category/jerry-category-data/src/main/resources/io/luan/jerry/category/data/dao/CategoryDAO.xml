<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.luan.jerry.category.data.dao.CategoryDAO">

    <cache/>

    <select id="getCategory" resultType="io.luan.jerry.category.data.po.CategoryPO">
        SELECT
            P.*,
            COUNT(C.id) AS child_count
        FROM jerry_category.categories P
            LEFT JOIN jerry_category.categories C ON C.parent_id = P.id
        WHERE P.id = #{categoryId}
        GROUP BY P.id
    </select>

    <select id="getCategoryList" resultType="io.luan.jerry.category.data.po.CategoryPO">
        SELECT
            P.*,
            COUNT(C.id) AS child_count
        FROM jerry_category.categories P
            LEFT JOIN jerry_category.categories C ON C.parent_id = P.id
        GROUP BY P.id
    </select>

    <insert id="addCategory">
        INSERT INTO jerry_category.categories (
            id, name, parent_id, sort_order
        ) VALUES (
            #{category_id}, #{name}, #{parent_id}, #{sort_order}
        )
    </insert>

</mapper>